<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”µåŠ¨è‡ªè¡Œè½¦ç™¾ç§‘</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WXTKPB8C');</script>
  <!-- End Google Tag Manager -->
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WXTKPB8C"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <header>
    <h1>ğŸš´â€â™‚ï¸ ç”µåŠ¨è‡ªè¡Œè½¦ç™¾ç§‘</h1>
    <p>æ¢ç´¢ç»¿è‰²å‡ºè¡Œï¼Œä»ä¸€è¾†ç”µåŠ©åŠ›è½¦å¼€å§‹</p>
  </header>

  <section id="filters">
    <input type="text" id="searchInput" placeholder="æœç´¢å‹å·ã€å“ç‰Œæˆ–å‚æ•°..." />
    <select id="brandFilter">
      <option value="">å“ç‰Œ</option>
    </select>
    <select id="batteryFilter">
      <option value="">ç”µæ± å®¹é‡</option>
    </select>
    <select id="priceFilter">
      <option value="">ä»·æ ¼åŒºé—´</option>
    </select>
  </section>

  <main id="bike-list">
    <!-- å¡ç‰‡å®¹å™¨ -->
  </main>
  <div id="pagination"></div>

  <footer>
    <p>&copy; 2025 E-Bike Wiki | é™æ€é¡µé¢æ‰˜ç®¡äº GitHub Pages</p>
  </footer>

  <script>
  const PAGE_SIZE = 6;
  let bikesData = [];
  let filteredData = [];
  let currentPage = 1;

  // è·å–DOM
  const bikeList = document.getElementById('bike-list');
  const brandFilter = document.getElementById('brandFilter');
  const batteryFilter = document.getElementById('batteryFilter');
  const priceFilter = document.getElementById('priceFilter');
  const searchInput = document.getElementById('searchInput');
  const pagination = document.getElementById('pagination');

  // åŠ è½½æ•°æ®å¹¶åˆå§‹åŒ–
  fetch('data/bikes.json')
    .then(res => res.json())
    .then(data => {
      bikesData = data;
      initFilters(data);
      applyFiltersAndSearch();
    });

  // åˆå§‹åŒ–ç­›é€‰å™¨
  function initFilters(data) {
    const brands = [...new Set(data.map(bike => bike.brand))];
    const batteries = [...new Set(data.map(bike => bike.battery))];
    priceFilter.innerHTML = `
      <option value="">ä»·æ ¼åŒºé—´</option>
      <option value="0-4000">4000å…ƒä»¥ä¸‹</option>
      <option value="4000-5000">4000-5000å…ƒ</option>
      <option value="5000-6000">5000-6000å…ƒ</option>
      <option value="6000-99999">6000å…ƒä»¥ä¸Š</option>
    `;
    brands.forEach(brand => {
      const option = document.createElement('option');
      option.value = brand;
      option.textContent = brand;
      brandFilter.appendChild(option);
    });
    batteries.forEach(bat => {
      const option = document.createElement('option');
      option.value = bat;
      option.textContent = bat;
      batteryFilter.appendChild(option);
    });
  }

  // ç»‘å®šäº‹ä»¶
  brandFilter.onchange = batteryFilter.onchange = priceFilter.onchange = () => {
    currentPage = 1;
    applyFiltersAndSearch();
  };
  searchInput.oninput = () => {
    currentPage = 1;
    applyFiltersAndSearch();
  };

  // ç»„åˆç­›é€‰å’Œæœç´¢
  function applyFiltersAndSearch() {
    const selectedBrand = brandFilter.value;
    const selectedBattery = batteryFilter.value;
    const selectedPrice = priceFilter.value;
    const keyword = searchInput.value.trim().toLowerCase();

    filteredData = bikesData.filter(bike => {
      // ä»·æ ¼åŒºé—´
      let priceMatch = true;
      if (selectedPrice) {
        const [min, max] = selectedPrice.split('-').map(Number);
        priceMatch = bike.price >= min && bike.price <= max;
      }
      // å…³é”®è¯åŒ¹é…
      let keywordMatch = true;
      if (keyword) {
        keywordMatch =
          bike.name.toLowerCase().includes(keyword) ||
          bike.brand.toLowerCase().includes(keyword) ||
          bike.battery.toLowerCase().includes(keyword) ||
          (bike.range + '').includes(keyword) ||
          (bike.price + '').includes(keyword);
      }
      return (!selectedBrand || bike.brand === selectedBrand) &&
             (!selectedBattery || bike.battery === selectedBattery) &&
             priceMatch && keywordMatch;
    });

    renderBikes(filteredData, currentPage);
    renderPagination(filteredData.length, currentPage);
  }

  // æ¸²æŸ“å¡ç‰‡
  function renderBikes(data, page) {
    bikeList.innerHTML = '';
    if (data.length === 0) {
      bikeList.innerHTML = '<p style="text-align:center;color:#ccc;">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ç”µåŠ¨è‡ªè¡Œè½¦ã€‚</p>';
      return;
    }
    const start = (page - 1) * PAGE_SIZE;
    const end = start + PAGE_SIZE;
    data.slice(start, end).forEach(bike => {
      const card = document.createElement('div');
      card.className = 'bike-card';
      card.innerHTML = `
        <img src="${bike.image}" alt="${bike.name}" loading="lazy" />
        <div class="info">
          <h3>${bike.name}</h3>
          <p>å“ç‰Œï¼š${bike.brand}</p>
          <p>ç”µæ± å®¹é‡ï¼š${bike.battery}</p>
          <p>ç»­èˆªï¼š${bike.range} km</p>
          <p>ä»·æ ¼ï¼šï¿¥${bike.price}</p>
          <p>æ•´è½¦é‡é‡ï¼š${bike.weight} kg</p>
          <p>ç”µæœºåŠŸç‡ï¼š${bike.motorPower} W</p>
        </div>
      `;
      // æ”¯æŒæ–°æ ‡ç­¾é¡µæ‰“å¼€
      card.onclick = e => {
        if (e.ctrlKey || e.metaKey) {
          window.open(`detail/${bike.id}.html`, '_blank');
        } else {
          window.location.href = `detail/${bike.id}.html`;
        }
      };
      bikeList.appendChild(card);
    });
  }

  // æ¸²æŸ“åˆ†é¡µ
  function renderPagination(total, current) {
    pagination.innerHTML = '';
    const totalPages = Math.ceil(total / PAGE_SIZE);
    if (totalPages <= 1) return;

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.className = (i === current) ? 'active' : '';
      btn.onclick = () => {
        currentPage = i;
        renderBikes(filteredData, currentPage);
        renderPagination(filteredData.length, currentPage);
        window.scrollTo(0, 0);
      };
      pagination.appendChild(btn);
    }
  }
  </script>
</body>
</html>
